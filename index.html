<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Server Online</title>

<style>
body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:linear-gradient(135deg,#dbeafe,#f8fafc);
    min-height:100vh;
}
.bg-blur{
    position:fixed;
    width:300px;height:300px;
    background:radial-gradient(circle,#60a5fa,transparent 70%);
    top:-80px;right:-80px;
    filter:blur(60px);opacity:.6;
}
.container{
    max-width:420px;
    margin:auto;
    padding:16px;
    position:relative;
    z-index:2;
}
.header{text-align:center;margin-bottom:16px}
.total{
    background:rgba(255,255,255,.85);
    padding:12px;
    border-radius:14px;
    text-align:center;
    margin-bottom:16px;
}
.card{
    background:rgba(255,255,255,.9);
    border-radius:18px;
    padding:16px;
    margin-bottom:14px;
}
.card-header{
    display:flex;
    justify-content:space-between;
}
.server-name{
    font-size:18px;
    font-weight:600;
    display:flex;
    gap:8px;
    align-items:center;
}
.dot{
    width:10px;height:10px;
    background:#22c55e;border-radius:50%;
}
.progress{
    height:8px;
    background:#e5e7eb;
    border-radius:10px;
    margin:10px 0;
}
.progress-bar{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#22c55e,#4ade80);
    transition:.3s;
}
.status{font-size:13px;color:#666}
.offline .dot,
.offline .progress-bar{
    background:#ef4444;
}
</style>
</head>

<body>
<div class="bg-blur"></div>

<div class="container">
    <div class="header">
        <h1>Server Online</h1>
        <div id="updateTime">อัปเดตล่าสุด: -</div>
    </div>

    <div class="total">
        รวมทั้งหมด: <b id="total">0</b> คน
    </div>

    <div id="servers"></div>
</div>

<script>
const MAX = 500;
const servers = [
 {name:"TH1",url:"http://45.144.167.176:8888/server/online"},
 {name:"TH2",url:"http://82.26.104.151:8888/server/online"},
 {name:"TH3",url:"http://82.26.104.196:8888/server/online"},
 {name:"TH4",url:"http://82.26.104.197:8888/server/online"},
 {name:"TH5",url:"http://82.26.104.199:8888/server/online"}
];

const box = document.getElementById("servers");

servers.forEach((s,i)=>{
 box.innerHTML+=`
 <div class="card" id="card-${i}">
   <div class="card-header">
     <div class="server-name"><span class="dot"></span>${s.name}</div>
     <div id="count-${i}">0/${MAX}</div>
   </div>
   <div class="progress"><div class="progress-bar" id="bar-${i}"></div></div>
   <div class="status" id="status-${i}">กำลังตรวจสอบ...</div>
 </div>`;
});

async function loadData(){
 let total=0;

 await Promise.all(
   servers.map(async (s,i)=>{
     try{
       const r=await fetch("proxy.php?url="+encodeURIComponent(s.url));
       const v=parseInt(await r.text())||0;

       total+=v;
       document.getElementById(`count-${i}`).innerText=`${v}/${MAX}`;
       document.getElementById(`bar-${i}`).style.width=(v/MAX*100)+"%";
       document.getElementById(`status-${i}`).innerText="ออนไลน์";
       document.getElementById(`card-${i}`).classList.remove("offline");
     }catch{
       document.getElementById(`status-${i}`).innerText="ออฟไลน์";
       document.getElementById(`card-${i}`).classList.add("offline");
     }
   })
 );

 document.getElementById("total").innerText=total;
 document.getElementById("updateTime").innerText=
   "อัปเดตล่าสุด: "+new Date().toLocaleTimeString("th-TH");
}

loadData();
setInterval(loadData,10000);
</script>
</body>
</html>
